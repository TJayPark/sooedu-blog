<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Soo Edu AI 맞춤형 영어 커리큘럼 - 자녀의 레벨과 흥미에 맞는 최적의 영어 학습 과정을 확인하세요">
    <title>AI 맞춤 커리큘럼 | Soo Edu - 저렴한 화상영어</title>

    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/curriculum.css">
</head>

<body>
    <div class="curriculum-container">
        <header class="curriculum-header">
            <h1>🎯 AI 맞춤 영어 커리큘럼</h1>
            <p>우리 아이의 레벨과 흥미에 딱 맞는 학습 과정을 확인해보세요</p>
        </header>

        <!-- Parent Benefits Section -->
        <section class="parent-benefits">
            <h2>왜 Soo Edu의 AI 커리큘럼이 다를까요?</h2>
            <ul class="benefits-list">
                <li>자녀의 현재 레벨에 맞춘 단계별 학습 과정</li>
                <li>관심사 기반 맞춤 콘텐츠로 학습 동기 극대화</li>
                <li>Neo4j AI 기술로 개인별 최적 학습 경로 제시</li>
                <li>실시간 진도 추적 및 약점 보완</li>
            </ul>
        </section>

        <!-- Filter Section -->
        <section class="curriculum-filters">
            <div class="filter-grid">
                <div class="filter-group">
                    <label for="level-select">📊 영어 레벨</label>
                    <select id="level-select">
                        <option value="">모든 레벨 보기</option>
                        <option value="Beginner">초급 (Beginner)</option>
                        <option value="Intermediate">중급 (Intermediate)</option>
                        <option value="Advanced">고급 (Advanced)</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="interest-select">❤️ 관심 분야</label>
                    <select id="interest-select">
                        <option value="">모든 관심사 보기</option>
                        <option value="Games">게임 & 엔터테인먼트</option>
                        <option value="Sports">스포츠</option>
                        <option value="Science">과학 & 기술</option>
                        <option value="Arts">예술 & 음악</option>
                        <option value="Reading">독서 & 스토리</option>
                        <option value="Travel">여행 & 문화</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Results Section -->
        <section id="curriculum-results">
            <!-- Loading state -->
            <div class="curriculum-loading" id="loading-state" style="display: none;">
                <p>⏳ 커리큘럼을 불러오는 중...</p>
            </div>

            <!-- Error state -->
            <div class="curriculum-error" id="error-state" style="display: none;">
                <h3>⚠️ 데이터를 불러올 수 없습니다</h3>
                <p id="error-message"></p>
                <p><small>Neo4j 프록시 서버가 실행 중인지 확인해주세요:
                        <code>python3 /Users/tjaypark/sooedubot_workspace/scripts/neo4j_read_proxy.py</code></small></p>
            </div>

            <!-- Empty state -->
            <div class="curriculum-empty" id="empty-state" style="display: none;">
                <p>📚 선택한 조건에 맞는 커리큘럼이 없습니다</p>
                <p><small>다른 레벨이나 관심사를 선택해보세요</small></p>
            </div>

            <!-- Curriculum cards -->
            <div class="curriculum-list" id="curriculum-list"></div>
        </section>

        <!-- CTA Section -->
        <section
            style="margin-top: 3rem; padding: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; color: white; text-align: center;">
            <h2>우리 아이에게 맞는 커리큘럼을 직접 체험해보세요</h2>
            <p style="font-size: 1.1rem; margin: 1rem 0;">지금 무료 레벨 테스트를 신청하시면 맞춤 커리큘럼을 추천해드립니다</p>
            <div style="margin-top: 2rem;">
                <a href="https://pf.kakao.com/_AxgExexj/chat"
                    style="display: inline-block; background: #fbbf24; color: #1a202c; padding: 1rem 2rem; border-radius: 8px; text-decoration: none; font-weight: 700; font-size: 1.1rem;">
                    카카오톡으로 무료 상담받기
                </a>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script src="/assets/js/neo4j-client.js"></script>
    <script>
        // UI Elements
        const levelSelect = document.getElementById('level-select');
        const interestSelect = document.getElementById('interest-select');
        const loadingState = document.getElementById('loading-state');
        const errorState = document.getElementById('error-state');
        const emptyState = document.getElementById('empty-state');
        const curriculumList = document.getElementById('curriculum-list');
        const errorMessage = document.getElementById('error-message');

        // State management
        let currentLevel = '';
        let currentInterest = '';

        // Show loading
        function showLoading() {
            loadingState.style.display = 'block';
            errorState.style.display = 'none';
            emptyState.style.display = 'none';
            curriculumList.innerHTML = '';
        }

        // Show error
        function showError(message) {
            loadingState.style.display = 'none';
            errorState.style.display = 'block';
            emptyState.style.display = 'none';
            curriculumList.innerHTML = '';
            errorMessage.textContent = message;
        }

        // Show empty
        function showEmpty() {
            loadingState.style.display = 'none';
            errorState.style.display = 'none';
            emptyState.style.display = 'block';
            curriculumList.innerHTML = '';
        }

        // Show results
        function showResults(items) {
            loadingState.style.display = 'none';
            errorState.style.display = 'none';
            emptyState.style.display = 'none';

            if (items.length === 0) {
                showEmpty();
                return;
            }

            curriculumList.innerHTML = items.map(item => createCurriculumCard(item)).join('');
        }

        // Create curriculum card HTML
        function createCurriculumCard(item) {
            const level = item.level || 'Intermediate';
            const levelClass = `level-${level.toLowerCase()}`;
            const topics = item.topics || [];
            const duration = item.duration || item.duration_weeks || 4;

            return `
                <div class="curriculum-card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">${item.title || '영어 학습 과정'}</h3>
                            <span class="card-level-badge ${levelClass}">${level}</span>
                        </div>
                    </div>
                    <p class="card-description">${item.description || '흥미진진한 영어 학습 과정입니다'}</p>
                    ${topics.length > 0 ? `
                        <div class="card-topics">
                            <div class="card-topics-title">📚 학습 주제</div>
                            <div class="topics-list">
                                ${topics.map(topic => `<span class="topic-tag">${topic}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                    <div class="card-duration">
                        <span>⏱️</span>
                        <span>${duration}주 과정</span>
                    </div>
                </div>
            `;
        }

        // Load curriculum
        async function loadCurriculum() {
            showLoading();

            try {
                let results;

                // Priority: Interest > Level > All
                if (currentInterest) {
                    results = await neo4jClient.getCurriculumByInterest(currentInterest);
                } else if (currentLevel) {
                    results = await neo4jClient.getCurriculumByLevel(currentLevel);
                } else {
                    // Load all - generic query
                    const query = `
                        MATCH (c:Curriculum)
                        RETURN c.title as title,
                               c.description as description,
                               c.level as level,
                               c.topics as topics,
                               c.duration_weeks as duration
                        ORDER BY c.level, c.order
                        LIMIT 50
                    `;
                    results = await neo4jClient.query(query);
                }

                showResults(results);
            } catch (error) {
                console.error('Load error:', error);
                showError(error.message);
            }
        }

        // Event listeners
        levelSelect.addEventListener('change', (e) => {
            currentLevel = e.target.value;
            loadCurriculum();
        });

        interestSelect.addEventListener('change', (e) => {
            currentInterest = e.target.value;
            loadCurriculum();
        });

        // Initial load
        (async () => {
            // Check proxy health
            const healthy = await neo4jClient.checkHealth();
            if (!healthy) {
                showError('Neo4j 프록시 서버에 연결할 수 없습니다. 서버를 시작해주세요.');
                return;
            }

            // Load initial curriculum
            await loadCurriculum();
        })();
    </script>
</body>

</html>